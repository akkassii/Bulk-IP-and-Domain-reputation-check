<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VirusTotal Bulk Reputation Checker</title>
  <!-- Tailwind (CDN build for GitHub Pages / no bundler needed) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-5xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-3xl font-bold">VirusTotal Bulk Reputation Checker</h1>
      <p class="text-sm text-gray-600 mt-1">Client‑side tool for bulk <span class="font-semibold">domain</span> and <span class="font-semibold">IP</span> reputation checks via VirusTotal API v3. Outputs CSV.</p>
      <p class="text-xs text-amber-700 mt-2 bg-amber-50 border border-amber-200 rounded-lg p-3">⚠️ Security note: this page makes API calls <em>from your browser</em>. Your VirusTotal API key is stored only in memory, but it will be visible in your network calls. For shared/team use, deploy a tiny proxy (Cloudflare Worker / Vercel function) to keep the key server‑side.</p>
    </header><!-- Controls -->
<section class="grid md:grid-cols-2 gap-6">
  <div class="space-y-3">
    <label class="block text-sm font-medium">VirusTotal API Key <span class="text-red-600">*</span></label>
    <input id="apiKey" type="password" placeholder="VT API key" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />

    <label class="block text-sm font-medium mt-4">Indicator type</label>
    <div class="flex items-center gap-4">
      <label class="inline-flex items-center gap-2"><input type="radio" name="iocType" value="domain" checked class="accent-blue-600"/> Domain</label>
      <label class="inline-flex items-center gap-2"><input type="radio" name="iocType" value="ip" class="accent-blue-600"/> IP Address</label>
    </div>

    <label class="block text-sm font-medium mt-4">Input (one per line)</label>
    <textarea id="iocInput" rows="10" placeholder="example.com\n8.8.8.8\nmalicious-domain.tld" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>

    <div class="flex items-center gap-3 mt-2">
      <input id="respectRateLimit" type="checkbox" class="accent-blue-600" checked />
      <label for="respectRateLimit" class="text-sm">Respect Public API free‑tier rate limit (≤4 req/min)</label>
    </div>

    <div class="flex items-center gap-3 mt-2">
      <input id="skipOnError" type="checkbox" class="accent-blue-600" checked />
      <label for="skipOnError" class="text-sm">Skip on 429 / transient errors (log and continue)</label>
    </div>

    <div class="flex flex-wrap gap-3 mt-4">
      <input id="fileInput" type="file" accept=".txt,.csv" class="text-sm" />
      <button id="loadFileBtn" class="px-3 py-2 text-sm border rounded-lg hover:bg-gray-100">Load file to textarea</button>
    </div>

    <div class="mt-6 flex gap-3">
      <button id="startBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Start checks</button>
      <button id="downloadBtn" disabled class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg cursor-not-allowed">Download CSV</button>
      <button id="clearBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-100">Clear</button>
    </div>
  </div>

  <div class="space-y-4">
    <div class="border rounded-xl p-4 bg-white shadow-sm">
      <h2 class="font-semibold mb-2">Progress</h2>
      <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
        <div id="progressBar" class="bg-blue-600 h-3 rounded-full" style="width:0%"></div>
      </div>
      <div class="mt-2 text-xs text-gray-600">
        <span id="progressText">0 / 0</span>
      </div>
    </div>

    <div class="border rounded-xl p-4 bg-white shadow-sm">
      <h2 class="font-semibold mb-2">Results (live)</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm" id="resultsTable">
          <thead>
            <tr class="text-left border-b">
              <th class="py-2 pr-3">Input</th>
              <th class="py-2 pr-3">Type</th>
              <th class="py-2 pr-3">Mal</th>
              <th class="py-2 pr-3">Susp</th>
              <th class="py-2 pr-3">Harmless</th>
              <th class="py-2 pr-3">Undetected</th>
              <th class="py-2 pr-3">Reputation</th>
              <th class="py-2 pr-3">Categories</th>
              <th class="py-2 pr-3">Last Analysis</th>
              <th class="py-2 pr-3">VT Link</th>
              <th class="py-2 pr-3">Error</th>
            </tr>
          </thead>
          <tbody id="resultsBody"></tbody>
        </table>
      </div>
    </div>

    <div class="text-xs text-gray-500">
      <p>CSV columns: input,type,malicious,suspicious,harmless,undetected,reputation,categories,last_analysis_date,vt_link,error</p>
    </div>
  </div>
</section>

<footer class="mt-10 text-xs text-gray-500">
  <p>VirusTotal Public API limits: 4 req/min, 500/day. Consider Premium for higher quotas.</p>
  <p>© <span id="year"></span> Bulk VT Checker</p>
</footer>

  </div>  <script>
    const apiBase = 'https://www.virustotal.com/api/v3';

    const el = {
      apiKey: document.getElementById('apiKey'),
      iocInput: document.getElementById('iocInput'),
      respectRate: document.getElementById('respectRateLimit'),
      skipOnError: document.getElementById('skipOnError'),
      startBtn: document.getElementById('startBtn'),
      downloadBtn: document.getElementById('downloadBtn'),
      clearBtn: document.getElementById('clearBtn'),
      fileInput: document.getElementById('fileInput'),
      loadFileBtn: document.getElementById('loadFileBtn'),
      progressBar: document.getElementById('progressBar'),
      progressText: document.getElementById('progressText'),
      resultsBody: document.getElementById('resultsBody'),
      year: document.getElementById('year')
    };
    el.year.textContent = new Date().getFullYear();

    function parseLines(text) {
      return text
        .split(/\r?\n/) // split lines
        .map(s => s.trim())
        .filter(Boolean);
    }

    function isIP(v) { return /^\d{1,3}(?:\.\d{1,3}){3}$/.test(v); }
    function isDomain(v) { return /^(?=.{1,253}$)(?!-)(?:[a-zA-Z0-9-]{1,63}\.)+[a-zA-Z]{2,63}$/.test(v); }

    function delay(ms) { return new Promise(res => setTimeout(res, ms)); }

    function updateProgress(done, total) {
      const pct = total ? Math.round((done / total) * 100) : 0;
      el.progressBar.style.width = pct + '%';
      el.progressText.textContent = `${done} / ${total}`;
    }

    function addRow(rec) {
      const tr = document.createElement('tr');
      tr.className = 'border-b last:border-0';
      const cells = [rec.input, rec.type, rec.malicious, rec.suspicious, rec.harmless, rec.undetected, rec.reputation, rec.categories, rec.last_analysis_date, rec.vt_link ? `<a class="text-blue-600 underline" href="${rec.vt_link}" target="_blank" rel="noopener">open</a>` : '', rec.error || ''];
      cells.forEach((c, i) => {
        const td = document.createElement('td');
        td.className = 'py-2 pr-3 align-top';
        td.innerHTML = (c === undefined || c === null) ? '' : String(c);
        tr.appendChild(td);
      });
      el.resultsBody.appendChild(tr);
    }

    function toCSV(rows) {
      const headers = ['input','type','malicious','suspicious','harmless','undetected','reputation','categories','last_analysis_date','vt_link','error'];
      const esc = v => {
        if (v === undefined || v === null) return '';
        const s = String(v);
        return /[",\n]/.test(s) ? '"' + s.replace(/"/g,'""') + '"' : s;
      };
      const body = rows.map(r => headers.map(h => esc(r[h])).join(','));
      return [headers.join(','), ...body].join('\n');
    }

    async function vtFetch(path, apiKey) {
      const res = await fetch(apiBase + path, { headers: { 'x-apikey': apiKey } });
      if (res.status === 429) {
        const err = new Error('Rate limited (429)');
        err.status = 429; throw err;
      }
      if (!res.ok) {
        const txt = await res.text();
        const err = new Error(`HTTP ${res.status}: ${txt.slice(0,200)}`);
        err.status = res.status; throw err;
      }
      return res.json();
    }

    function extractCommon(obj) {
      const a = obj?.data?.attributes || {};
      const s = a.last_analysis_stats || a.stats || {};
      const categories = a.categories ? Object.values(a.categories).join(';') : '';
      const lastTime = a.last_analysis_date ? new Date(a.last_analysis_date * 1000).toISOString() : '';
      return {
        malicious: s.malicious ?? '',
        suspicious: s.suspicious ?? '',
        harmless: s.harmless ?? '',
        undetected: s.undetected ?? '',
        reputation: (a.reputation ?? a.popularity_ranks?.rank ?? ''),
        categories,
        last_analysis_date: lastTime,
      };
    }

    async function checkDomain(domain, apiKey) {
      const json = await vtFetch(`/domains/${encodeURIComponent(domain)}`, apiKey);
      const common = extractCommon(json);
      return {
        input: domain,
        type: 'domain',
        vt_link: `https://www.virustotal.com/gui/domain/${encodeURIComponent(domain)}`,
        error: '',
        ...common,
      };
    }

    async function checkIP(ip, apiKey) {
      const json = await vtFetch(`/ip_addresses/${encodeURIComponent(ip)}`, apiKey);
      const common = extractCommon(json);
      return {
        input: ip,
        type: 'ip',
        vt_link: `https://www.virustotal.com/gui/ip-address/${encodeURIComponent(ip)}`,
        error: '',
        ...common,
      };
    }

    async function runChecks() {
      const apiKey = el.apiKey.value.trim();
      if (!apiKey) { alert('Please enter your VirusTotal API key.'); return; }

      const lines = parseLines(el.iocInput.value);
      if (!lines.length) { alert('Please paste domains/IPs (one per line).'); return; }

      const type = document.querySelector('input[name="iocType"]:checked').value;
      const total = lines.length;
      let done = 0;
      updateProgress(0, total);
      el.resultsBody.innerHTML = '';
      const records = [];

      const useThrottle = el.respectRate.checked;
      const baseDelay = useThrottle ? 16000 : 250; // ~4/min vs fast

      for (const item of lines) {
        const targetType = type; // user‑selected
        try {
          // basic sanity based on selected type
          if (targetType === 'domain' && !isDomain(item)) throw new Error('Not a valid domain');
          if (targetType === 'ip' && !isIP(item)) throw new Error('Not a valid IPv4');

          const rec = targetType === 'domain' ? await checkDomain(item, apiKey) : await checkIP(item, apiKey);
          records.push(rec);
          addRow(rec);
        } catch (e) {
          const rec = {
            input: item,
            type: targetType,
            malicious: '', suspicious: '', harmless: '', undetected: '', reputation: '', categories: '', last_analysis_date: '', vt_link: '',
            error: (e && e.message) ? e.message : String(e)
          };
          records.push(rec);
          addRow(rec);
          if (!el.skipOnError.checked && e && e.status === 429) {
            alert('Hit 429 rate limit. Enable "Skip on 429" or turn on throttling.');
            break;
          }
        }
        done++;
        updateProgress(done, total);
        if (done < total) await delay(baseDelay);
      }

      // enable download
      el.downloadBtn.disabled = false;
      el.downloadBtn.classList.remove('bg-gray-300','text-gray-700','cursor-not-allowed');
      el.downloadBtn.classList.add('bg-green-600','text-white','hover:bg-green-700');

      // attach CSV to button click
      el.downloadBtn.onclick = () => {
        const csv = toCSV(records);
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `vt_bulk_results_${new Date().toISOString().replace(/[:.]/g,'-')}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };
    }

    el.startBtn.addEventListener('click', runChecks);

    el.clearBtn.addEventListener('click', () => {
      el.iocInput.value = '';
      el.resultsBody.innerHTML = '';
      updateProgress(0, 0);
      el.downloadBtn.disabled = true;
      el.downloadBtn.className = 'px-4 py-2 bg-gray-300 text-gray-700 rounded-lg cursor-not-allowed';
    });

    el.loadFileBtn.addEventListener('click', async () => {
      const f = el.fileInput.files?.[0];
      if (!f) { alert('Choose a .txt or .csv file first.'); return; }
      const text = await f.text();
      // Try to auto-extract 1st column if CSV; otherwise take whole lines
      const isCSV = /,/.test(text.split(/\r?\n/).find(l => l.trim()).trim());
      let lines = [];
      if (isCSV) {
        const rows = text.split(/\r?\n/).filter(Boolean);
        for (const r of rows) {
          const cell = r.split(',')[0].replace(/^"|"$/g,'').trim();
          if (cell) lines.push(cell);
        }
      } else {
        lines = parseLines(text);
      }
      el.iocInput.value = lines.join('\n');
    });
  </script></body>
</html>